<htmlform formUuid="5dfc3ea6-9783-44a3-a3fd-7249f4e313bc" formName="Operation Triple Zero (OTZ) Service" formEncounterType="08bb08f1-5b14-487d-bdf3-74095f11c43e" formVersion="2018">
    <!-- Autogenerated example form  (template from 01-Nov-2010 -->
    <macros>
        paperFormId = (Fill this in)
        headerColor =#2f1c55
        fontOnHeaderColor = white
    </macros>

    <style>
        .section {
            border: 1px solid $headerColor;
            padding: 2px;
            text-align: left;
            margin-bottom: 1em;
        }
        #otz_table {
            border-collapse: collapse;
        }

        #otz_table, #otz_table th, #otz_table td {
            border: 1px solid black;
            padding: 8px;
        }
        .sectionHeader {
            background-color: $headerColor;
            color: $fontOnHeaderColor;
            display: block;
            padding: 2px;
            font-weight: bold;
        }
        table.baseline-aligned td {
            vertical-align: baseline;
        }
        form select, .form select {
            max-width: 150px;
        }
        form input, form select,  form ul.select, .form input, .form select,  .form ul.select {
            max-width: 150px;
        }
        .error{
            color:red;
        }
    </style>
    <script type="text/javascript">

        var $ = jQuery;
        $(document).ready(function ()
        {
            $('.hasDatepicker').attr('readonly', true)
        });

        function checkARTStartDate() {
                var artStartDate = document.getElementById("ARTStartDateLookup").innerText.trim();
                if (artStartDate === "") {
                    alert("clients without an ART start date cannot be enrolled into OTZ.");
                    window.history.back();
                }
            }
            document.addEventListener("DOMContentLoaded", function () {
                checkARTStartDate();
            });
    </script>

    <span style="float:right">Paper Form ID: $paperFormId</span>
    <h2>Operation Triple Zero (OTZ) Service (v1.0)</h2>
    <!-- <lookup complexExpression="#set ($checkdate = 0) #set( $checkdate = $fn.latestEncounter('11eb2647-91b4-482a-9cb3-08573e0d219b').encounterDatetime)"/> -->
    <span id="malecheck" style="display: none" ><lookup expression="patient.gender" codePrefix="gender_"/></span>

    <!-- <includeIf velocityTest="$checkdate != 0 "> -->
    <section headerLabel="Clinical Summary">

        <table id="dashboard" cellspacing="10" cellpadding="5" align="center">
            <tr><td><b>Last Weight:</b><font color='blue' style="font-weight: bold"><lookup expression="fn.latestObs('5089').valueNumeric"/></font>
                kg <lookup expression="fn.latestObs('5089').obsDatetime"/></td><td><b>Last Height:</b><font color='blue' style="font-weight: bold">
                <lookup expression="fn.latestObs('5090').valueNumeric"/></font> cm <lookup expression="fn.latestObs('5090').obsDatetime"/></td>
                <td><b>Last CD4 Count:</b><font color='blue' style="font-weight: bold"><lookup expression="fn.latestObs('5497').valueNumeric"/></font> c/mm <sup>3</sup>
                    <lookup expression="fn.latestObs('5497').obsDatetime"/></td></tr>
            <tr><td><b>Last Viral Load:</b><font color='blue' style="font-weight: bold"><lookup expression="fn.latestObs('856').valueNumeric"/></font>
                copies/ml <lookup expression="fn.latestObs('856').obsDatetime"/></td><td><b>Current Regimen:</b>
                <font color='blue' style="font-weight: bold"><lookup expression="fn.latestObs('164506').valueCoded.name"/></font> <lookup expression="fn.latestObs('164506').obsDatetime"/>
            </td><td><b>ART Start Date:</b>
                <font color='blue' id="ARTStartDateLookup" style="font-weight: bold"><lookup expression="fn.latestObs(159599).getValueDatetime()"/></font></td></tr>
            <tr><td></td><td>
            </td></tr>

        </table>

    </section>


    <section headerLabel="1. Encounter Details">
        <table>
            <tr>
                <td class="alnright">Visit Date</td>
                <td>
                    <encounterDate default="now"  id="encounterDate" showTime="false" allowFutureDates="false" required="true" />
                </td>
                <td></td>
            </tr>
        </table>
    </section>
    <section headerLabel="OTZ Program Enrollment">
        <table class="" style="padding: 10px;">

            <tbody>

            <tr>
                <td width="30%">
                    Date Enrolled into OTZ: <encounterDate default="today"/>
                    <enrollInProgram programId="5" showDate="false" />
                </td>
                <includeIf velocityTest="$patient.gender == 'F' ">
                    <td width="30%">
                        <!--<obs conceptId="166269" style="checkbox"/> -->
                        <obs conceptId="166269" answerConceptId="1065" answerLabel="OTZ Plus?" style="checkbox" toggle="specifyOther" />
                    </td>
                    <td width="40%"  id="specifyOther">Date Enrolled into OTZ Plus: <obs conceptId="166350" allowFutureDates="False" id="otzplus"/></td>
                </includeIf>
            </tr>

            <tr>
                <td width="50%"><obs conceptId="166270" answerConceptId="1065" style="checkbox" answerLabel="Full Disclosure?" toggle="specifydisclosureDate"/></td>
                <td width="50%" id="specifydisclosureDate">
                    Date of Full Disclosure <obs conceptId="166271" allowFutureDates="False"/>
                </td>
            </tr>
            </tbody>
        </table>
        <table class="" style="padding: 10px;">
            <tr>
                <td width="50%">Enrolled By</td>
                <td width="50%"><obs conceptId="166356" style="person" /></td>
            </tr>
        </table>
    </section>

    <section headerLabel="">
        <table class="baseline-aligned" id="otz_table">
            <thead>
            <tr style="background-color: darkslateblue; padding: 10px; color: white">
                <td colspan="4">Modules Activity/Date of Completion (Select Yes/No against module and indicate date) </td>
            </tr>
            </thead>
            <tbody>

            <tr>
                <td><obs conceptId="166256" style="checkbox" answerConceptId="1065" answerLabel="Positive Living" id="posLiving" toggle="posLivingDate"/></td>
                <td><span id="posLivingDate">Positive Living Completion Date: <obs id="posLivingDat" conceptId="166261" allowFutureDates="false" /></span></td>
            </tr>
            <tr>
                <td><obs conceptId="166257" style="checkbox" answerConceptId="1065" answerLabel="Treatment Literacy" id="treatLit" toggle="treatLitDate"/></td>
                <td><span  id="treatLitDate">Treatment Literacy Completion Date: <obs id="treatLitDat" conceptId="166262" allowFutureDates="false" /></span> </td>
            </tr>
            <tr>
                <td><obs conceptId="166258" style="checkbox" answerConceptId="1065" answerLabel="Adolescents Participation" id="adoPart" toggle="adoPartDate"/></td>
                <td><span id="adoPartDate">Adolescents Participation Completion Date: <obs id="adoPartDat" conceptId="166263"  /></span></td>
            </tr>
            <tr>
                <td><obs conceptId="166259" style="checkbox" answerConceptId="1065" answerLabel="Leadership Training" id="leadTrain" toggle="leadTrainDate"/></td>
                <td><span id="leadTrainDate">Leadership Training Completed Date: <obs id="leadTrainDat" conceptId="166264" allowFutureDates="false" /></span></td>
            </tr>
            <tr>
                <td><obs conceptId="166260" style="checkbox" answerConceptId="1065" answerLabel="Peer-to-Peer Mentorship" id="peerMentor" toggle="peerMentorDate"/></td>
                <td><span id="peerMentorDate">Peer-to-Peer Mentorship Completed Date: <obs id="peerMentorDat" conceptId="166265" allowFutureDates="false" /></span></td>
            </tr>
            <tr>
                <td><obs conceptId="166255" style="checkbox" answerConceptId="1065" answerLabel="Role of OTZ in 95-95-95" id="role95" toggle="role95Date"/></td>
                <td><span id="role95Date">Role of OTZ in 95-95-95 Completed Date: <obs id="role95Dat" conceptId="166266" allowFutureDates="false" /></span></td>
            </tr>
            <tr>
                <td><obs conceptId="166267" style="checkbox" answerConceptId="1065" answerLabel="OTZ Champion Orientation" id="role95" toggle="orientationDate"/></td>
                <td><span id="orientationDate">OTZ Champion Orientation Completed Date: <obs id="orientationDat" conceptId="166268" allowFutureDates="false" /></span></td>
            </tr>
            </tbody>
        </table>
    </section>
    <section>


        <table class="" style="padding: 10px;">
            <tr>
                <td width="50%">
                    <obs conceptId="166272" answerConceptId="1065" answerLabel="Transitioned to Adult Clinic?" style="checkbox" toggle="specifyOther2" />

                </td>
                <td width="50%"  id="specifyOther2">Date Transitioned to Adult Clinic: <obs conceptId="166273" allowFutureDates="False" /></td>
            </tr>
        </table>
    </section>

    <section headerLabel="2. Outcome">
        <table class="" style="padding: 10px;">
            <tr>
                <td width="20%">Outcome:</td>
                <td width="30%">
                    <obs conceptId="166275" id="otzOutcome" answerConceptIds="166351,166274">
                        <controls>
                            <when value="166351" thenDisplay="#reactivation,#oBy" />
                            <when value="166274" thenDisplay="#eId" />
                        </controls>
                    </obs>
                </td>
                <td><span id="outDate">Outcome Date:
                       <obs conceptId="166008" allowFutureDates="false" />
                    </span>
                </td>

            </tr>
        </table>
        <table class="" style="padding: 10px;" id="exitedBy">
            <tr>
                <td width="50%"><span id="eId">Exited</span><span id="oBy">Signed</span> By</td>
                <td width="50%"><obs conceptId="166353" style="person" /></td>
            </tr>
        </table>
    </section>

    <section headerLabel="Reactivation" id="reactivation">
        <table class="" style="padding: 10px;">
            <tr>
                <td width="50%">
                    <obs conceptId="166355" style="checkbox" answerConceptId="1065" answerLabel="Returning Patient"
                         id="returning" toggle="dateReturned, returedBy"/>
                </td>
                <td width="50%">
                    <span id="dateReturned">Date Returned: <obs conceptId="166354" allowFutureDates="false" /></span>
                </td>

            </tr>
        </table>
        <table class="" style="padding: 10px;" id="returedBy">
            <tr>
                <td width="50%">Returned By</td>
                <td width="50%"><obs conceptId="166352" style="person" /></td>
            </tr>
        </table>
    </section>
    <section headerLabel="Signature">
        <table>
            <tbody>
            <tr>
                <td>Signature:</td>
                <td>
                    <encounterProviderAndRole default="currentUser" encounterRole="240b26f9-dd88-4172-823d-4a8bfeb7841f" required="true" />
                </td>
                <td>Facility:</td>
                <td>
                    <encounterLocation default="SessionAttribute:emrContext.sessionLocationId" />
                </td>
            </tr>
            </tbody>
        </table>
    </section>
    <submit/>
    <!-- </includeIf> -->
    <!-- <includeIf velocityTest="$checkdate == 0 ">
        <b><font color='#8b0000' style="font-weight: bold; font-size:25px; padding: 35px 0px">
            This client needs to be enrolled on ART for this form to be active</font></b>
    </includeIf> -->
    <script type="text/javascript">

        beforeSubmit.push(function() {
            var val_encounterDate = getValue('encounterDate.value');
            var val_otzplus = getValue('otzplus.value');
            var val_posLiving = getValue('posLiving.value');
            var val_posLivingDate = getValue('posLivingDat.value');
            var val_treatLit = getValue('treatLit.value');
            var val_treatLitDate = getValue('treatLitDat.value');
            var val_adoPart = getValue('adoPart.value');
            var val_adoPartDate = getValue('adoPartDat.value');
            var val_leadTrain = getValue('leadTrain.value');
            var val_leadTrainDate = getValue('leadTrainDat.value');
            var val_peerMentor = getValue('peerMentor.value');
            var val_peerMentorDate = getValue('peerMentorDat.value');
            var val_role95 = getValue('role95.value');
            var val_role95Date = getValue('role95Dat.value');
            var val_orientationDate = getValue('orientationDat.value');
            var malecheck = document.getElementById("malecheck").innerText;

            if (malecheck != "M") {
            if(val_otzplus){

            console.log('val_otzplus');
                if ((val_otzplus &lt; val_encounterDate) || (val_otzplus == val_encounterDate)) {
                    console.log('heck1val_otzplus');
                    getField('otzplus.error').html('Date Enrolled into OTZ Plus cannot be earlier than or same as OTZ Enrolment date').show();
                    return false;
                    }
                }

            }

                    if (val_posLiving) {

                    console.log('val_posLiving');
                        if(val_posLivingDate === "") {
                            console.log('val_posLivingDate');
                            getField('posLivingDat.error').html('Module/Activity end date required').show();
                            getField('posLiving.error').html('').hide();
                            return false;
                        }

                    if ((val_posLivingDate &lt; val_encounterDate) || (val_posLivingDate == val_encounterDate)){

                    console.log('check1val_posLivingDate');
                        getField('posLivingDat.error').html('Positive Living Completion Date cannot be earlier than or same as OTZ  Enrolment date').show();
                        getField('posLiving.error').html('').hide();
                        return false;
                        }

                    } else if (!val_posLiving) {

                    console.log('elseval_posLiving');
                        if(val_posLivingDate !== "") {

                    console.log('elseval_posLivingDate1');
                            getField('posLiving.error').html('Module/Activity must be selected').show();
                            getField('posLivingDat.error').html('').hide();
                            console.log('elseval_posLivingDate2');
                            return false;
                            console.log('elseval_posLivingDate3');
                        }
                        console.log('elseval_posLivingDate4');
                    }

                    if (val_treatLit) {

                    console.log('val_treatLit');
                        if(val_treatLitDate === "") {

                    console.log('val_treatLitDate');
                            getField('treatLitDat.error').html('Module/Activity end date required').show();
                            getField('treatLit.error').html('').hide();
                            return false;
                        }

                    if ((val_treatLitDate &lt; val_encounterDate) || (val_treatLitDate == val_encounterDate)){

                    console.log('check1val_treatLitDate');
                        getField('treatLitDat.error').html('Treatment Literacy Completion Date cannot be earlier than or same as OTZ Enrolment date').show();
                        getField('treatLit.error').html('').hide();
                        return false;
                        }

                    } else if (!val_treatLit) {

                    console.log('elseval_treatLit');
                        if(val_treatLitDate !== "") {

                    console.log('elseval_treatLitDate');
                            getField('treatLit.error').html('Module/Activity must be selected').show();
                            getField('treatLitDat.error').html('').hide();
                            return false;
                        }
                    }

                    if (val_adoPart) {

                    console.log('val_adoPart');
                        if(val_adoPartDate === "") {

                    console.log('val_adoPartDate');
                            getField('adoPartDat.error').html('Module/Activity end date required').show();
                            getField('adoPart.error').html('').hide();
                            return false;
                        }

                    if ((val_adoPartDate &lt; val_encounterDate) || (val_adoPartDate == val_encounterDate)){

                    console.log('check1val_adoPartDate');
                        getField('adoPartDat.error').html('Adolescents Participation Completion Date cannot be earlier than or same as OTZ Enrolment date').show();
                        getField('adoPart.error').html('').hide();
                        return false;
                        }

                    } else if (!val_adoPart) {
                    console.log('elseval_adoPart');
                        if(val_adoPartDate !== "") {
                    console.log('elseval_adoPartDate');
                            getField('adoPart.error').html('Module/Activity must be selected').show();
                            getField('adoPartDat.error').html('').hide();
                            return false;
                        }
                    }


                    if (val_leadTrain) {
                    console.log('val_leadTrain');
                        if(val_leadTrainDate === "") {
                    console.log('val_leadTrainDate');
                            getField('leadTrainDat.error').html('Module/Activity end date required').show();
                            getField('leadTrain.error').html('').hide();
                            return false;
                        }

                        if ((val_leadTrainDate &lt; val_encounterDate) || (val_leadTrainDate == val_encounterDate)){
                        console.log('check1val_leadTrainDate');
                        getField('leadTrainDat.error').html('Leadership Training Completed Date cannot be earlier than or same as OTZ Enrolment date').show();
                        getField('leadTrain.error').html('').hide();
                        return false;
                        }


                    } else if (!val_leadTrain) {

                    console.log('elseval_leadTrain');
                        if(val_leadTrainDate !== "") {
                    console.log('elseval_leadTrainDate');
                            getField('leadTrain.error').html('Module/Activity must be selected').show();
                            getField('leadTrainDat.error').html('').hide();
                            return false;
                        }
                    }



                    if (val_peerMentor) {
                    console.log('val_peerMentor');
                        if(val_peerMentorDate === "") {
                    console.log('val_peerMentorDate');
                            getField('peerMentorDat.error').html('Module/Activity end date required').show();
                            getField('peerMentor.error').html('').hide();
                            return false;
                        }
                        if ((val_peerMentorDate &lt; val_encounterDate) || (val_peerMentorDate == val_encounterDate)){

                    console.log('check1val_peerMentorDate');
                            getField('peerMentorDat.error').html('Peer-to-Peer Mentorship Completed Date cannot be earlier than or same as OTZ Enrolment date').show();
                        getField('peerMentor.error').html('').hide();
                        return false;
                        }

                    } else if (!val_peerMentor) {
                    console.log('elseval_peerMentor');
                        if(val_peerMentorDate !== "") {
                    console.log('elseval_peerMentorDate');
                            getField('peerMentor.error').html('Module/Activity must be selected').show();
                            getField('peerMentorDat.error').html('').hide();
                            return false;
                        }
                    }

                    if (val_role95) {
                    console.log('val_role95');
                        if(val_role95Date === "") {
                    console.log('val_role95Date');
                            getField('role95Dat.error').html('Module/Activity end date required').show();
                            getField('role95.error').html('').hide();
                            return false;
                        }

                    if ((val_role95Date &lt; val_encounterDate) || (val_role95Date == val_encounterDate)){

                    console.log('check1val_role95Date');
                        getField('role95Dat.error').html('Role of OTZ in 95-95-95 Completed Date cannot be earlier than or same as OTZ Enrolment date').show();
                        getField('role95.error').html('').hide();
                        return false;
                        }

                    } else if (!val_role95) {
                    console.log('elseval_role95');
                        if(val_role95Date !== "") {
                    console.log('elseval_role95Date');
                            getField('role95.error').html('Module/Activity must be selected').show();
                            getField('role95Dat.error').html('').hide();
                            return false;
                        }
                    }

                    if(val_orientationDate){

                    console.log('orientationDate');
                    if ((val_orientationDate &lt; val_encounterDate) || (val_orientationDate == val_encounterDate)){

                    console.log('orientationDat');
                        getField('orientationDat.error').html('OTZ Champion Orientation Completed Date cannot be earlier than or same as OTZ Enrolment date').show();
                        getField('role95Dat.error').html('').hide();
                        return false;
                        }
                    }



            return true;
        });
    </script>


    <!-- END OF FORM

    Simple examples to copy-and-paste. Full reference at http://wiki.openmrs.org/x/kg8z

    SECTION
        <section headerLabel="\#. Title">
            Content
        </section>

    NUMERIC OBSERVATION
        <obs conceptId="id-of-numeric-concept" labelText="Label before"/>

    DATE OBSERVATION
        <obs conceptId="id-of-date-concept" labelText="Label before"/>

    CODED OBSERVATION
    (as a dropdown)
        <obs conceptId="id-of-coded-concept" labelText="Label before"/>
    (as radio buttons)
        <obs conceptId="id-of-coded-concept" labelText="Label before" style="radio"/>
    (as an autocomplete)
        <obs conceptId="id-of-coded-concept" labelText="Label before" style="autocomplete" answerClasses="Diagnosis"/>
    (as a checkbox for a specific answer)
        <obs conceptId="id-of-coded-concept" labelText="Label before" answerConceptId="id-of-answer-concept" answerLabel="label for answer"/>
    (as a dropdown with specific choices)
        <obs conceptId="id-of-coded-concept" labelText="Label before" answerConceptIds="concept-id-1,concept-id-2,concept-id-3" answerLabels="Label 1,Label 2, Label 3"/>


    FREE TEXT OBSERVATION
    (as a normal text field)
        <obs conceptId="id-of-text-concept" labelText="Label before"/>
    (as a textarea)
        <obs conceptId="id-of-text-concept" labelText="Label before" rows="4" cols="80"/>
    -->
    <ifMode mode="EDIT" include="false">
        <lookup complexExpression="
                #set( $encounter=0 )
                #set( $encounter=$fn.latestEncounter('08bb08f1-5b14-487d-bdf3-74095f11c43e'))
                #if( $encounter !=0 )
                &lt;script type=&quot;text/javascript&quot;>
            if (window.location.href.indexOf('/module/htmlformentry/htmlForm.form') == -1) {
            window.location.href = window.location.protocol + &quot;//&quot; + window.location.host + &quot;/&quot;+ OPENMRS_CONTEXT_PATH +
            &quot;/htmlformentryui/htmlform/editHtmlFormWithStandardUi.page?visitId=$encounter.visit.visitId&amp;formUuid=5dfc3ea6-9783-44a3-a3fd-7249f4e313bc&amp;patientId=$patient.patientId&amp;encounterId=$encounter.encounterId&amp;returnUrl=%2F&quot; + OPENMRS_CONTEXT_PATH +
            &quot;%2Fcoreapps%2Fclinicianfacing%2Fpatient.page%3FpatientId%3D$patient.patientId&quot;;
            }

            &lt;/script>
            #end"/>
    </ifMode>
</htmlform>