<org.openmrs.module.reporting.dataset.definition.SqlDataSetDefinition id="1" uuid="287920c5-2e27-4c5d-af76-589f45743a94" retired="false">
  <name>OTZLineList</name>
  <description>An excel export of the OTZ form variables</description>
  <creator id="2" uuid="1c3db49d-440a-11e6-a65c-00e04c680037"/>
  <dateCreated id="3">2021-04-28 15:27:30 UTC</dateCreated>
  <changedBy reference="2"/>
  <dateChanged id="4">2021-04-28 15:42:12 UTC</dateChanged>
  <parameters id="5">
    <org.openmrs.module.reporting.evaluation.parameter.Parameter id="6">
      <name>startDate</name>
      <label>startDate</label>
      <type>java.util.Date</type>
      <required>true</required>
    </org.openmrs.module.reporting.evaluation.parameter.Parameter>
    <org.openmrs.module.reporting.evaluation.parameter.Parameter id="7">
      <name>endDate</name>
      <label>endDate</label>
      <type>java.util.Date</type>
      <required>true</required>
    </org.openmrs.module.reporting.evaluation.parameter.Parameter>
  </parameters>
  <id>245</id>
  <sqlQuery>SELECT&#xd;
   global_property.property_value as DatimCode,&#xd;
   pid2.identifier as PepfarID,&#xd;
   pid3.identifier as HospID,&#xd;
   person.gender as Sex,&#xd;
   DATE_FORMAT(person.birthdate,&apos;%d-%b-%Y&apos;) as DOB,&#xd;
   TIMESTAMPDIFF(YEAR,person.birthdate,pprg.date_enrolled) as `AgeAtEnrollment`,&#xd;
   TIMESTAMPDIFF(YEAR,person.birthdate,CURDATE()) as `CurrentAge`,&#xd;
   visit.visit_id as VisitID,&#xd;
   DATE_FORMAT(enc.encounter_datetime,&apos;%d-%b-%Y&apos;) as DateEnrolledIntoOTZ,&#xd;
   MAX(IF(obs.concept_id=166269,cn1.name, NULL))&#xd;
   as `OTZPlus`,&#xd;
   MAX(IF(obs.concept_id=166350,DATE_FORMAT(obs.value_datetime,&apos;%d-%b-%Y&apos;), NULL))&#xd;
   as `DateEnrolledIntoOTZPlus`,&#xd;
   MAX(IF(obs.concept_id=166356,obs.value_text, NULL))&#xd;
   as `EnrolledBy`,&#xd;
   MAX(IF(obs.concept_id=166270,cn1.name, NULL))&#xd;
   as `FullDisclosure`,&#xd;
   MAX(IF(obs.concept_id=166271,DATE_FORMAT(obs.value_datetime,&apos;%d-%b-%Y&apos;), NULL))&#xd;
   as `FullDisclosureDate`,&#xd;
   MAX(IF(obs.concept_id=166256,cn1.name, NULL))&#xd;
   as `PositiveLiving`,&#xd;
    MAX(IF(obs.concept_id=166261,DATE_FORMAT(obs.value_datetime,&apos;%d-%b-%Y&apos;), NULL))&#xd;
   as `PositiveLivingCompletionDate`,&#xd;
   MAX(IF(obs.concept_id=166257,cn1.name, NULL))&#xd;
   as `TreatmentLiteracy`,&#xd;
   MAX(IF(obs.concept_id=166262,DATE_FORMAT(obs.value_datetime,&apos;%d-%b-%Y&apos;), NULL))&#xd;
   as `TreatmentLiteracyCompletionDate`,&#xd;
   MAX(IF(obs.concept_id=166258,cn1.name, NULL))&#xd;
   as `AdolescentsParticipation`,&#xd;
   MAX(IF(obs.concept_id=166263,DATE_FORMAT(obs.value_datetime,&apos;%d-%b-%Y&apos;), NULL))&#xd;
   as `AdolescentsParticipationCompletionDate`,&#xd;
   MAX(IF(obs.concept_id=166259,cn1.name, NULL))&#xd;
   as `LeadershipTraining`,&#xd;
   MAX(IF(obs.concept_id=166264,DATE_FORMAT(obs.value_datetime,&apos;%d-%b-%Y&apos;), NULL))&#xd;
   as `LeadershipTrainingCompletionDate`,&#xd;
   MAX(IF(obs.concept_id=166260,cn1.name, NULL))&#xd;
   as `PeerToPeerMentorship`,&#xd;
   MAX(IF(obs.concept_id=166265,DATE_FORMAT(obs.value_datetime,&apos;%d-%b-%Y&apos;), NULL))&#xd;
   as `	PeerToPeerMentorshipCompletionDate`,&#xd;
   MAX(IF(obs.concept_id=166255,cn1.name, NULL))&#xd;
   as `RoleOfOTZIn959595`,&#xd;
   MAX(IF(obs.concept_id=166266,DATE_FORMAT(obs.value_datetime,&apos;%d-%b-%Y&apos;), NULL))&#xd;
   as `RoleOfOTZIn959595CompletionDate`,&#xd;
   MAX(IF(obs.concept_id=166267,cn1.name, NULL))&#xd;
   as `OTZChampionOrientation`,&#xd;
   MAX(IF(obs.concept_id=166268,DATE_FORMAT(obs.value_datetime,&apos;%d-%b-%Y&apos;), NULL))&#xd;
   as `OTZChampionOrientationCompletionDate`,&#xd;
   &#xd;
   MAX(IF(obs.concept_id=166272,cn1.name, NULL))&#xd;
   as `TransitionedToAdultClinic`,&#xd;
   &#xd;
   MAX(IF(obs.concept_id=166273,DATE_FORMAT(obs.value_datetime,&apos;%d-%b-%Y&apos;), NULL))&#xd;
   as `DateTransitionedToAdultClinic`,&#xd;
   &#xd;
   MAX(IF(obs.concept_id=166275,cn1.name, NULL))&#xd;
   as `OTZProgramOutcome`,&#xd;
   MAX(IF(obs.concept_id=166008,DATE_FORMAT(obs.value_datetime,&apos;%d-%b-%Y&apos;), NULL))&#xd;
   as `DateofOutcome`,&#xd;
   MAX(IF(obs.concept_id=166355,cn1.name, NULL))&#xd;
   as `ReturningPatient`,&#xd;
   MAX(IF(obs.concept_id=166354,DATE_FORMAT(obs.value_datetime,&apos;%d-%b-%Y&apos;), NULL))&#xd;
   as `DateReturned`,&#xd;
   MAX(IF(obs.concept_id=166352,obs.value_text, NULL))&#xd;
   as `ReactivatedBy`&#xd;
   FROM&#xd;
   obs&#xd;
   LEFT JOIN patient ON(patient.patient_id=obs.person_id and obs.voided=0 and patient.voided=0)&#xd;
   LEFT JOIN person ON(person.person_id=patient.patient_id and person.voided=0)&#xd;
   LEFT join encounter enc on(enc.encounter_id=obs.encounter_id and enc.voided=0 and obs.voided=0 and enc.form_id=73)&#xd;
   LEFT JOIN visit on (enc.visit_id=visit.visit_id and visit.voided=0)&#xd;
   left join concept_name cn1 on(obs.value_coded=cn1.concept_id and cn1.locale=&apos;en&apos; and cn1.locale_preferred=1)&#xd;
   LEFT JOIN patient_identifier pid2 on(pid2.patient_id=patient.patient_id and patient.voided=0 and pid2.identifier_type=4 and pid2.voided=0)&#xd;
   LEFT JOIN patient_identifier pid3 on(pid3.patient_id=patient.patient_id and patient.voided=0 and pid3.identifier_type=5 and pid3.voided=0)&#xd;
   LEFT JOIN global_property on(global_property.property=&apos;facility_datim_code&apos;)&#xd;
   LEFT JOIN patient_program pprg on(pprg.patient_id=patient.patient_id and pprg.program_id=3)&#xd;
   WHERE patient.voided=0 &#xd;
   and enc.voided=0 and &#xd;
   enc.encounter_datetime BETWEEN&#xd;
   :startDate and :endDate&#xd;
   GROUP BY patient.patient_id,enc.encounter_id;&#xd;
   &#xd;
</sqlQuery>
</org.openmrs.module.reporting.dataset.definition.SqlDataSetDefinition>